<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body{
        background-color: rgb(14, 18, 22);
        color: rgb(80, 255, 197);
    }
    #mainBlock{
        display: flex;
        justify-content: space-between;
        min-height: 400px;
        margin-top: 25vh;
    }

    #inputDataDiv{
        display: flex;
        width: 250px;
        margin-left: 10%;
        border: solid;
        min-width: 200px;
        border-radius: 25px;
        justify-content: center;    
        align-items: center;  
        text-align: center;        
    }

    #getDataDiv{
        display: flex;
        width: 250px;
        border-radius: 25px;
        margin-right: 10%;
        border: solid;
        min-width: 200px;
        justify-content: center;        
        align-items:center;
    }
    input{
        border-radius: 6px;
        text-decoration: none;
    }
    label{
        display: flex;
        padding-top: 10px;
        padding-bottom: 5px;
        justify-content: center;
    }
    button{
        margin-top: 4px;
    }
</style>


<body>
    <div id="mainBlock">
        <div id="inputDataDiv">
            <form id="formsForDate">
                <label>Введите имя</label>
                <input id="fierstNameIn" required>
                <br>
                <label>Введите фамилию</label>
                <input id="secondNameIn" required>
                <button type="submit">Подтвердить</button>
            </form>
        </div>
        <div id="getDataDiv">
            <div id="parentDiv"></div>
            <button onclick="getData()">получить данные</button>
        </div>
    </div>
</body>


<script>
    async function getData(){
        try {
            const response = await fetch("http://localhost:1200/users", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            })

            if (!response.ok) {
                throw new Error(`Ошибка сервера: ${response.status}`)
            }

            // 3. Получаем данные (массив пользователей)
            const users = await response.json()

            // 4. Очищаем родительский div перед новой загрузкой
            const parentDiv = document.getElementById("parentDiv");
            parentDiv.innerHTML = "";

            // 5. Если пользователей нет, выводим сообщение
            if (users.length === 0) {
                parentDiv.innerHTML = "<p>Нет пользователей в базе.</p>";
                return;
            }

            // 6. Создаем таблицу для отображения пользователей
            const table = document.createElement("table");
            table.style.width = "100%";
            table.style.borderCollapse = "collapse";
            table.style.color = "rgb(80, 255, 197)";

            // 7. Добавляем заголовок таблицы
            const thead = document.createElement("thead");
            thead.innerHTML = `
                <tr>
                    <th style="border-bottom: 1px solid rgb(80, 255, 197); padding: 8px;">Имя</th>
                    <th style="border-bottom: 1px solid rgb(80, 255, 197); padding: 8px;">Фамилия</th>
                </tr>
            `;
            table.appendChild(thead);

            // 8. Добавляем строки с пользователями
            const tbody = document.createElement("tbody");
            users.forEach((user) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td style="border-bottom: 1px solid rgba(80, 255, 197, 0.3); padding: 8px; text-align: center;">${user.name}</td>
                    <td style="border-bottom: 1px solid rgba(80, 255, 197, 0.3); padding: 8px; text-align: center;">${user.secondName}</td>
                `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);

            // 9. Добавляем таблицу в parentDiv
            parentDiv.appendChild(table);

        } catch (err) {
            console.error("Ошибка при получении данных:", err);
            alert(`Произошла ошибка: ${err.message}`);
        }
    }


    document.getElementById("formsForDate").addEventListener("submit", async(e) =>{
        e.preventDefault()

        let fierstNameInput = document.getElementById("fierstNameIn").value
        let secondNameInput = document.getElementById("secondNameIn").value

        try{
            const respons = await fetch("http://localhost:1200/users", {
                method: "POST",
                headers:{
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: fierstNameInput,
                    secondName: secondNameInput
                })
            })

            if(respons.ok){
                const data = await respons.json()
                alert(`Данные отправлены: ${JSON.stringify(data)}`)
                document.getElementById("formsForDate").reset() //clear form
            }else{
                alert("Ошибка при отправке данных")
            }

        }catch(err){
            console.log(err.name)
            alert("Произошла ошибка")
        }
    });
</script>

</html>